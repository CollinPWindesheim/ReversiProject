var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};
$jscomp.findInternal=function(a,b,h){a instanceof String&&(a=String(a));for(var k=a.length,c=0;c<k;c++){var p=a[c];if(b.call(h,p,c,a))return{i:c,v:p}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,h){a!=Array.prototype&&a!=Object.prototype&&(a[b]=h.value)};
$jscomp.getGlobal=function(a){a=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global,a];for(var b=0;b<a.length;++b){var h=a[b];if(h&&h.Math==Math)return h}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,h,k){if(b){h=$jscomp.global;a=a.split(".");for(k=0;k<a.length-1;k++){var c=a[k];c in h||(h[c]={});h=h[c]}a=a[a.length-1];k=h[a];b=b(k);b!=k&&null!=b&&$jscomp.defineProperty(h,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,h){return $jscomp.findInternal(this,a,h).v}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(a){function b(){this.batch_=null}function h(f){return f instanceof c?f:new c(function(a,b){a(f)})}if(a&&!$jscomp.FORCE_POLYFILL_PROMISE)return a;b.prototype.asyncExecute=function(a){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(a)};var k=$jscomp.global.setTimeout;b.prototype.asyncExecuteFunction=function(a){k(a,0)};b.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var n=0;n<a.length;++n){var b=a[n];a[n]=null;try{b()}catch(t){this.asyncThrow_(t)}}}this.batch_=null};b.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var f=this.createResolveAndReject_();try{a(f.resolve,f.reject)}catch(x){f.reject(x)}};c.prototype.createResolveAndReject_=function(){function a(a){return function(f){c||(c=!0,a.call(b,f))}}var b=this,c=!1;
return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var f=null!=a;break a;case "function":f=!0;break a;default:f=!1}f?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var f=void 0;try{f=a.then}catch(x){this.reject_(x);return}"function"==typeof f?
this.settleSameAsThenable_(f,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b+"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=0;a<this.onSettledCallbacks_.length;++a)p.asyncExecute(this.onSettledCallbacks_[a]);
this.onSettledCallbacks_=null}};var p=new b;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(t){c.reject(t)}};c.prototype.then=function(a,b){function f(a,b){return"function"==typeof a?function(b){try{h(a(b))}catch(y){n(y)}}:b}var h,n,k=new c(function(a,b){h=a;n=b});this.callWhenSettled_(f(a,h),f(b,n));return k};
c.prototype.catch=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function c(){switch(f.state_){case 1:a(f.result_);break;case 2:b(f.result_);break;default:throw Error("Unexpected state: "+f.state_);}}var f=this;null==this.onSettledCallbacks_?p.asyncExecute(c):this.onSettledCallbacks_.push(c)};c.resolve=h;c.reject=function(a){return new c(function(b,c){c(a)})};c.race=function(a){return new c(function(b,c){for(var f=$jscomp.makeIterator(a),k=f.next();!k.done;k=f.next())h(k.value).callWhenSettled_(b,
c)})};c.all=function(a){var b=$jscomp.makeIterator(a),f=b.next();return f.done?h([]):new c(function(a,c){function k(b){return function(c){n[b]=c;p--;0==p&&a(n)}}var n=[],p=0;do n.push(void 0),p++,h(f.value).callWhenSettled_(k(n.length-1),c),f=b.next();while(!f.done)})};return c},"es6","es3");$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(a){return"number"!==typeof a?!1:!isNaN(a)&&Infinity!==a&&-Infinity!==a}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(a){return Number.isFinite(a)?a===Math.floor(a):!1}},"es6","es3");
var Game=function(a){function b(a,g){e.init=!0;var d=function(){H.removeEventListener("animationend",d);H.classList.remove("fade","fade-in","show");R.classList.add("d-none");"spel"==a&&(g.spelers&&2==g.spelers.length?setTimeout(function(a){f(g,8<g.spel.bord.length?"parallel":"serie")},250):n(!1))};document.getElementById("modal-add-submit").addEventListener("click",function(){var a=document.getElementById("modal-add-description"),d=document.getElementById("modal-add-size");a.matches(":invalid")||
d.matches(":invalid")||x(a.value.trim(),parseInt(d.value))});document.getElementById("settings-toggle").addEventListener("click",function(){var a=document.getElementById("settings"),d=$("#settings-expand");a.classList.contains("expanded")&&!window.matchMedia("(min-width: 768px)").matches?(a.classList.remove("expanded"),d.slideUp(250)):(a.classList.add("expanded"),e.unread=0,d.slideDown(250,y))});document.getElementById("leave").addEventListener("click",G);document.getElementById("forfeit").addEventListener("click",
C);v.querySelector("button").addEventListener("click",B);F.querySelector("button").addEventListener("click",function(){e.color=null;e.turn=null;e.spel=null;e.size=8;u.invoke("Group").catch(function(a){return r(a.toString())})});D.addEventListener("keypress",function(a){if("Enter"==a.key&&!a.shiftKey)return a.preventDefault(),z(),!1});D.addEventListener("input",function(){M.disabled=!D.value.trim()});M.addEventListener("click",z);$("#list").on("click","li.list-group-item-action",function(){t($(this).data("id"))});
$("#bord").on("click",".tile.move",function(){var a=$(this);E(a.index(),a.parent().index())});if("lobby"==a){var b=g.find(function(a){return a.participating});b?(g=b,a="spel"):k(g)}"spel"==a&&p(g);I(a);H.classList.add("fade-in","show");H.addEventListener("animationend",d)}function h(){fetch("/api/lobby").then(function(a){if(!a.ok)throw Error("Er is een fout opgetreden. Probeer het later opnieuw.");return a.json()}).then(function(a){k(a);I(e.spel?"spel":"lobby")}).catch(function(a){return r(a).show()})}
function k(a){A.innerHTML="";var d=document.createElement("div");d.classList.add("last-child","text-center");d.innerText="Er zijn geen spellen waaraan je mee kan doen.";A.append(d);a.forEach(function(a){var d=document.createElement("li");d.classList.add("list-group-item",a.participating?"text-muted":"list-group-item-action","flex-column","align-items-start");d.setAttribute("data-id",a.spel.id);var g=document.createElement("div");g.classList.add("d-flex","w-100","justify-content-between");var b=document.createElement("h5");
b.classList.add("mb-1");b.innerText=a.speler.name;var c=document.createElement("small");c.classList.add("text-muted");c.innerText=(new Date(a.spel.date)).toLocaleString("nl-NL");g.append(b,c);b=document.createElement("p");b.classList.add("mb-1");b.innerText=a.spel.description;var L=document.createElement("small");L.classList.add("text-muted","d-flex");[{icon:"border_all",info:a.spel.size},{icon:"emoji_events",info:Math.round(a.speler.won/a.speler.sum*100)+"%"}].forEach(function(a){var d=document.createElement("div");
d.classList.add("d-flex","mr-4","mr-sm-5");var g=document.createElement("i");g.classList.add("material-icons");g.innerText=a.icon;var b=document.createElement("span");b.classList.add("mb-auto","ml-3","mt-auto");b.innerText=a.info;d.append(g,b);L.append(d)});d.append(g,b,L);A.append(d)})}function c(a){fetch("/api/spel").then(function(a){if(!a.ok)throw Error("Er is een fout opgetreden. Probeer het later opnieuw.");return a.json()}).then(a).catch(function(a){return r(a).show()})}function p(a,g){g=void 0===
g?!1:g;e.size=a.spel.size;e.spel=a.spel.id;e.unread=0;q.innerHTML="";D.value="";M.disabled=!0;w.style.setProperty("--tile-size","calc(100% / "+e.size+")");w.innerHTML="";F.classList.add("d-none");F.classList.remove("show","fade-in");for(var d=0;d<a.spel.size;d++){var b=document.createElement("div");b.classList.add("row");for(var c=0;c<a.spel.size;c++){var l=document.createElement("div");l.classList.add("tile");b.append(l)}w.append(b)}d=a.spelers&&2==a.spelers.length;n(d);g&&d&&f(a,8<a.spel.bord.length?
"parallel":"serie")}function f(a,g){g=void 0===g?!1:g;a.color&&(e.color=a.color);e.turn=a.spel.turn;n(!0);var d=document.getElementById("turn");1==e.turn?(d.classList.add("black"),d.classList.remove("white")):2==e.turn&&(d.classList.add("white"),d.classList.remove("black"));O.innerText=(e.turn==e.color?"Jij bent":"Je tegenstander is")+" aan de beurt";var b=a.spel.bord.filter(function(a){return 1==a.kleur}).length,c=a.spel.bord.filter(function(a){return 2==a.kleur}).length;d=$jscomp.makeIterator(document.getElementsByClassName("score-black"));
for(var l=d.next();!l.done;l=d.next())l.value.innerText=b;d=$jscomp.makeIterator(document.getElementsByClassName("score-white"));for(l=d.next();!l.done;l=d.next())l.value.innerText=c;a.spelers.forEach(function(a){return document.getElementById("name-"+(1==a.color?"black":"white")).innerText=a.name});P();g=g||a.spel.history.pop()||!0;S(a.spel.bord,g).then(function(){P(a.spel.moves);e.forfeit=!1;if(1<a.spel.state){var d=document.getElementById("finish-result");2==a.spel.state?(d.classList.remove("d-none"),
d=b==c?"Gelijk spel":b>c&&1==e.color||b<c&&2==e.color?"Gefeliciteerd!":"Helaas..."):(d.classList.add("d-none"),d=3==a.spel.state&&1==e.color||4==a.spel.state&&2==e.color?"Je hebt opgegeven":"Je tegenstander heeft opgegeven");document.getElementById("finish-text").innerText=d;F.classList.remove("d-none");F.classList.add("show","fade-in");e.forfeit=!0}else a.color!=a.spel.turn||a.spel.moves.length||(v.classList.remove("d-none"),v.classList.add("show","fade-in"));d=$jscomp.makeIterator(document.getElementsByClassName("forfeit"));
for(var g=d.next();!g.done;g=d.next())g.value.disabled=e.forfeit})}function n(a){a=void 0===a?!1:a;var d=$("#settings-waiting"),b=$("#settings-playing");a?d.slideUp(250,function(){b.slideDown(250)}):(O.innerText="Aan het wachten...",b.slideUp(250,function(){d.slideDown(250)}))}function x(a,g){fetch("/api/lobby",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({Description:a,Size:g})}).then(function(a){if(!a.ok)throw e.spel=null,Error("Er is een fout opgetreden. Probeer het later opnieuw.");
return a.json()}).then(function(a){p(a);I("spel");$("#modal-add").modal("hide")}).catch(function(a){return r(a).show()})}function t(a){e.spel=a;fetch("/api/lobby/"+a,{method:"PUT",headers:{Accept:"application/json"}}).then(function(a){if(!a.ok)throw e.spel=null,Error("Er is een fout opgetreden. Probeer het later opnieuw.");}).catch(function(a){return r(a).show()})}function G(){e.spel=null;fetch("/api/lobby",{method:"DELETE"}).then(function(a){if(!a.ok)throw Error("Er is een fout opgetreden. Probeer het later opnieuw.");
return a.json()}).catch(function(a){return r(a).show()})}function C(){e.forfeit||(e.forfeit=!0,fetch("/api/spel",{method:"DELETE"}).then(function(a){if(!a.ok)throw e.forfeit=!1,Error("Er is een fout opgetreden. Probeer het later opnieuw.");}).catch(function(a){return r(a).show()}))}function B(){fetch("/api/spel",{method:"PUT"}).then(function(a){if(!a.ok)throw Error("Er is een fout opgetreden. Probeer het later opnieuw.");v.classList.add("d-none");v.classList.remove("show","fade-in")}).catch(function(a){return r(a).show()})}
function E(a,g){e.color==e.turn&&e.move&&(e.move=!1,fetch("/api/spel",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({X:a,Y:g})}).then(function(a){e.move=!0;if(!a.ok)throw Error("Deze zet is ongeldig.");}).catch(function(a){return r(a).show()}))}function z(){var a=D.value.trim();a&&fetch("/api/message/"+e.spel,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then(function(a){if(!a.ok)throw Error("Kan je bericht niet versturen...");
D.value=""}).catch(function(a){return r(a).show()})}function y(){Q.classList.toggle("d-none",0>=e.unread);Q.innerText=e.unread}function m(a){"lobby"==a?h():c(function(a){p(a,!0);I(e.spel?"spel":"lobby")})}var e={spel:null,size:8,turn:null,move:!0,init:!1,color:null,unread:0,forfeit:!1},v=document.getElementById("pas"),w=document.getElementById("bord"),A=document.getElementById("list"),q=document.getElementById("chat"),J=document.getElementById("spel"),l=document.getElementById("lobby"),F=document.getElementById("finish"),
H=document.getElementById("layout"),Q=document.getElementById("unread"),O=document.getElementById("status"),R=document.getElementById("loading"),D=document.getElementById("chat-box"),M=document.getElementById("chat-send"),r=function(a){return new Alert({message:a.toString(),type:"danger",dismissible:!0,buttons:{text:"Herladen",type:"light",callback:function(){location.reload()}},animate:!0,parent:"main"})},u=(new signalR.HubConnectionBuilder).withUrl("/ReversiMvcAppHub").build();u.start().catch(function(a){r(a.toString()).show()});
u.on("Init",function(a){if(e.init)m(a);else{var d="spel";"lobby"==a&&(d="lobby");fetch("/api/"+d).then(function(a){if(!a.ok)throw Error("Er is een fout opgetreden. Probeer het later opnieuw.");return a.json()}).then(function(a){b(d,a)}).catch(function(a){return r(a).show()})}});u.on("Group",m);u.on("Update",h);u.on("Start",function(a){e.spel==a?u.invoke("Group").catch(function(a){return r(a.toString())}):h()});u.on("Move",function(){c(f)});u.on("Finish",function(a){f(a)});u.on("Message",function(a){if(a.spelId==
e.spel){if(!a.type){var d=document.createElement("div");d.classList.add("chat-bubble-msg");d.innerText=a.content;var b=q.lastElementChild;if(b&&(a.color==e.color&&b.classList.contains("chat-bubble-right")||a.color!=e.color&&b.classList.contains("chat-bubble-left")))b.lastElementChild.append(d);else{b=document.createElement("div");b.classList.add("chat-bubble","chat-bubble-"+(a.color==e.color?"right":"left"));var c=document.createElement("div");c.classList.add("chat-bubble-body");c.append(d);b.append(c);
q.append(b)}e.color!=a.color&&null===q.offsetParent&&(e.unread++,y())}q.scrollTo(0,q.scrollHeight)}});var N=function(a,b){return!(0>a||a>=e.size||0>b||b>=e.size)},I=function(a){a="lobby"!=a&&a;J.classList.toggle("d-none",!a);l.classList.toggle("d-none",a)},K=function(a,b,c){void 0===b&&void 0===c&&"object"===typeof a&&(b=a.x,c=a.y,a=a.color||a.kleur);if(!N(b,c))return console.error("Given coordinates are not valid."),new Promise(function(a,b){return b("Given coordinates are not valid.")});if(1==a||
"zwart"==(a+"").toLowerCase())a="black";else if(2==a||"wit"==(a+"").toLowerCase())a="white";b=w.querySelector(".row:nth-child("+(c+1)+")>.tile:nth-child("+(b+1)+")");var d=b.querySelector(".fiche"),g=!1;d?(d.classList.contains(a.toLowerCase())&&(g=!0),d.classList.remove("black","white")):(d=document.createElement("div"),b.append(d));d.classList.add("fiche");"black"!=a&&"white"!=a||d.classList.add(a.toLowerCase());var e=function(a){d.removeEventListener("transitionend",e);d.removeEventListener("animationend",
e);a(d)};return new Promise(function(a){g?setTimeout(function(b){return a()},250):(d.addEventListener("transitionend",function(){e(a)}),d.addEventListener("animationend",function(){e(a)}))})},S=function(a,b,c){b=void 0===b?!1:b;if(void 0===c?0:c)for(var d=0;d<e.size;d++)for(var l=0;l<e.size;l++)a.find(function(a){return a.x==d&&a.y==l})||K("",d,l);var f=function(d){if(a.length)if("object"===typeof b&&Number.isInteger(b.x)&&Number.isInteger(b.y)){b.layer||(a=a.filter(function(a){return N(a.x,a.y)}),
b.layer=0);for(var c=[],e=b.x-b.layer;e<=b.x+b.layer;e++)for(var l=b.y-b.layer;l<=b.y+b.layer;l++)e!=b.x-b.layer&&e!=b.x+b.layer&&l!=b.y-b.layer&&l!=b.y+b.layer||!N(e,l)||(a=a.filter(function(a){return a.x==e&&a.y==l?(c.push(a),!1):!0}));b.layer++;if(c.length){var g=!0;c.forEach(function(a){return K(a).then(function(a){g&&(g=!1,f(d))})})}else setTimeout(function(a){return f(d)},250)}else!0===b||"serie"==b?K(a.shift()).then(function(a){return f(d)}):(!1===b||"parallel"==b)&&a.forEach(function(a){return K(a).then(function(a){return d()})});
else d()};return new Promise(function(a){f(a)})},P=function(a){for(var b=$jscomp.makeIterator(document.getElementsByClassName("tile")||[]),c=b.next();!c.done;c=b.next())c.value.classList.remove("move");a&&(Array.isArray(a)||(a=[a]),a.forEach(function(a){return document.querySelector(".row:nth-child("+(a.y+1)+")>.tile:nth-child("+(a.x+1)+")").classList.add("move")}))}}(),Alert=function(a){function b(a){if(void 0===a)return C;C=a;v.innerText=C}function h(a){if(void 0===a)return B;var b=!0;G.forEach(function(c){var e=
a==c;m.classList.toggle("alert-"+c,e);e&&(B=c,b=!1)});b&&(B="")}function k(a){if(void 0===a)return E;E=a instanceof HTMLElement?a:"string"===typeof a?document.querySelector(a):document.body}function c(a){a=void 0===a?null:a;null===a&&(a=!0);a=!!a;0!=a&&(m.classList.toggle("alert-dismissible",a),a?m.append(q):q.remove())}function p(a){y.forEach(function(a){a.remove()});y=[];a&&(Array.isArray(a)||(a=[a]),a.forEach(function(a){if("object"===typeof a){var b=document.createElement("button");b.setAttribute("type",
"button");b.classList.add("btn");b.innerText=a.text;"function"===typeof a.callback&&b.addEventListener("click",a.callback);a.close&&b.addEventListener("click",t);0<=G.indexOf(a.type)&&b.classList.add("btn-"+a.type);A.append(b);y.push(b)}}))}function f(a){a?(w.innerText=a,e.prepend(w)):w.remove()}function n(a){z=!!a}function x(){document.contains(m)&&!m.classList.contains("fade-out")&&m.classList.add("shake")}function t(){m.classList.remove("fade-in");document.contains(m)&&(z?m.classList.add("fade-out"):
m.remove())}var G="primary secondary success danger warning info light dark".split(" "),C,B,E,z=!1,y=[],m=document.createElement("div"),e=document.createElement("div"),v=document.createElement("p"),w=document.createElement("i");w.classList.add("col-auto","material-icons","d-none","d-sm-inline-block");e.classList.add("row");v.classList.add("col");m.classList.add("alert");e.append(v);m.append(e);var A=document.createElement("div");A.classList.add("btns","text-right");m.append(A);var q=document.createElement("button"),
J=document.createElement("span");J.innerHTML="&times;";q.append(J);q.classList.add("close");q.setAttribute("type","button");q.setAttribute("aria-label","Close");q.addEventListener("click",t);m.addEventListener("animationend",function(){m.classList.contains("fade-out")&&(m.classList.remove("fade-out"),z&&m.remove());m.classList.remove("fade-in","shake")});"object"!==typeof a&&(a={});h(a.type||"danger");k(a.parent||document.body);b(a.message||"");c(a.dismissible||!1);p(a.buttons||[]);f(a.icon||"");
n(a.animate);a.shake&&setTimeout(x,Number.isInteger(a.shake)&&0<a.shake?a.shake:3E3);return{show:function(a){a=void 0===a?0:a;m.classList.toggle("fade-in",z);E.prepend(m);var b=JSON.parse(localStorage.getItem("Alert"));b&&b.length||(b=[]);b.push({message:C,type:B});localStorage.setItem("Alert",JSON.stringify(b));0<a&&setTimeout(t,a)},hide:t,type:h,parent:k,message:b,dismissible:c,buttons:p,icon:f,animate:n,shake:x,history:function(){var a=JSON.parse(localStorage.getItem("Alert"));a&&a.length&&console.log(a.map(function(a){return"<type "+
a.type+"> - <"+a.message+">"}).join("\n"))},reset:function(){localStorage.setItem("Alert","[]")}}};
